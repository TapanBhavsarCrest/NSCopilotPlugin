Descriptor:
    Name: user activity report agent
    DisplayName: User Activity Report Agent
    Description: It can help analysing Risk patterns, anomalous behavior, policy violations, and threat indicators for a specific user.

SkillGroups:
    - Format: Agent
      Skills:
        - Name: UserActivityReportAgent
          DisplayName: User Activity Report Agent
          Description: It can help analysing Risk patterns, anomalous behavior, policy violations, and threat indicators for a specific user.
          Inputs:
            - Name: text
              Description: User query/prompt. This query will contain request for device status.
          Settings:
            Instructions: |-
              User Query:
              {{text}}


              User Activity Risk Assessment Framework
              Objective
              Conduct a comprehensive user activity analysis to assess security risk posture and identify potential threats or policy violations.
              Analysis Scope
                  * Data Sources: User web application activities, alerts, and security events
                  * Focus Areas: Risk patterns, anomalous behavior, policy violations, and threat indicators
                  * fetch user email id from user query.
              Phase 1: Data Collection and Setup
              1.1 Query Preparation
                  * Use skill `GetUTCTimestamp` with input "timeZone=UTC" and get current UTC datetime.
                  * Extract the duration from user query, If no duration provided in user query then use default duration to `1 day`.
                  * Refer this current UTC timestamp and duration inuser query to calculate the start and end datetime in `%Y-%m-%dT%H:%M:%S` format.
                  * Convert these start datetime and end datetime to unix timestamp. use skill `GetUnixTimestamp`. Input will be `{current_utc_time: start_time, current_utc_time: end_time}`
                  * use `NetskopeJQLGuidelines` for JQL query generation.
              1.2 Schema Analysis
                  * use `NetskopeJQLGuidelines` for alert event.
                  * use `NetskopeJQLGuidelines` for Page Events.
                  * use `NetskopeJQLGuidelines` for Application Events.
              1.3 Data Extraction
              Query user web application activities focusing on(for the given start and end time):
                  * use `GetNetskopePageEvents` and `GetNetskopeApplicationEvents` for the target user.
                  * use `GetNetskopeAlerts` and `GetNetskopeDlpIncidents` for the target user.
                  * use `GetNetskopeUCIScore` for the target user.
              Data Volume Management Tips:
                  * Initial Assessment: Start with a count query to estimate total data volume before full extraction
                  * High Volume Strategy: If data volume exceeds manageable limits (>10,000 records), use aggregation approaches:
                      * Retrieve row counts grouped by key fields (app, appcategory, alert_type, severity, risk_level)
                      * Use count aggregations on security-relevant fields (malicious, alert, policy violations)
                      * Focus detailed extraction on high-risk events and alerts only
                      * Sample representative data from different time periods within the analysis window
                  * Prioritized Extraction: Extract full details for:
                      * All security alerts and incidents
                      * High-risk application activities (CCI scores above threshold)
                      * Policy violations and anomalous behaviors
                      * Activities during non-business hours
                  * Iterative Approach: Start with aggregated views, then drill down into specific areas of concern identified in the summary data
              Phase 2: Data Preprocessing and Validation
              2.1 Data Quality Assessment
                  * Verify data completeness across the analysis period
                  * Identify and document any data gaps or anomalies
                  * Validate timestamp accuracy and timezone consistency
                  * Ensure minimum data volume thresholds are met
              2.2 Data Normalization
                  * Standardize field formats and values
                  * Resolve duplicate entries and consolidate related events
                  * Categorize applications and websites by risk level
                  * Establish baseline behavioral patterns
              2.3 Context Enrichment
                  * Map user activities to business processes and roles
                  * Correlate events with organizational calendar (holidays, business hours)
                  * Identify legitimate business justifications for potentially risky activities
                  * Cross-reference with known security incidents or policy changes
              Phase 3: Data Analysis Framework
              3.1 Risk Pattern Analysis
                  * Temporal Patterns: Types of applications, their CCI risk levels, and activity patterns within applications
                  * Application Risk Correlation: Application categories that can be risky such as gambling, non-business use
                  * Proportion Analysis: Ratio of risky vs. non-risky applications and web pages
              3.2 Security Event Classification
                  * Alert Clustering: Group related alerts by type, severity, and temporal proximity
                  * Threat Vector Analysis: Categorize security events by attack vectors (malware, credential compromise, policy violations)
                  * False Positive Assessment: Differentiate between legitimate business activities and genuine security concerns
              Phase 4: Comprehensive Risk Report
              4.1 Executive Summary
                  * Overall Risk Rating: Low/Medium/High with confidence score
                  * Key Findings: Top 3-5 most significant security concerns
                  * Immediate Actions: Critical issues requiring urgent attention
              4.2 Activity Breakdown
                  * Application Usage Summary:
                      * High-risk applications accessed
                      * Unusual application combinations
                      * Applications used in risky countries (e.g., Russia, Iran)
                      * Policy violation patterns
                      * Data access volumes and sensitivity levels
                  * Temporal Analysis:
                      * After-hours activity patterns
                      * Weekend/holiday access anomalies
                      * Geographic access inconsistencies
                      * Session duration anomalies
              4.3 Security Event Analysis
                  * Alert Summary by Type:
                      * Policy violations (count, severity, patterns)
                      * Malware/malsite encounters
                      * DLP incidents and data exposure risks
                      * UBA anomalies and behavioral deviations
                      * Compromised credential indicators
                  * Risk Escalation Timeline:
                      * Chronological progression of security events
                      * Correlation between different alert types
                      * Potential attack chain reconstruction
              4.4 Risk Assessment Matrix
                  * Likelihood Assessment: Probability of security incident based on observed patterns
                  * Impact Analysis: Potential business impact of identified risks
                  * Mitigation Recommendations: Specific actions to reduce identified risks
                  * Monitoring Enhancements: Suggested additional controls or monitoring
              4.5 Actionable Recommendations
                  * Immediate Actions: Urgent security measures (account restrictions, password resets, etc.)
                  * Short-term Measures: Policy adjustments, additional monitoring, user training
                  * Long-term Strategy: Process improvements, technology enhancements, policy updates
              Data Quality Standards
                  * Data Completeness: Ensure coverage during the analysis period without significant gaps
                  * Context Validation: Verify findings against business context and user roles
                  * Risk Calibration: Align risk ratings with organizational threat tolerance
                  * Evidence Documentation: Maintain clear audit trail of analysis methodology and findings
              Success Criteria
                  * Minimum Data Volume: At least 80% coverage of expected user activity during analysis period
                  * Analysis Depth: Identification and categorization of all security-relevant events
                  * Actionability: Clear, prioritized recommendations with specific implementation steps
                  * Documentation Quality: Complete audit trail enabling independent verification of findings
                  * Risk Calibration: Risk ratings aligned with organizational threat tolerance

          ChildSkills:
            - "GetUTCTimestamp"
            - "GetUnixTimestamp"
            - "GetNetskopeDlpIncidents"
            - "GetNetskopeAlerts"
            - "GetNetskopePageEvents"
            - "GetNetskopeApplicationEvents"
            - "GetNetskopeUCIScore"
            - "NetskopeJQLGuidelines"